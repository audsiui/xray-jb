# Xray VLESS å·¥ç¨‹åŒ–éƒ¨ç½²è„šæœ¬

è½»é‡çº§ã€æ¨¡å—åŒ–çš„ Xray (VLESS + WebSocket) ä¸€é”®å®‰è£…è„šæœ¬ã€‚

ä¸“ä¸º **Alpine Linux** ä¼˜åŒ–ï¼ŒåŒæ—¶å®Œç¾æ”¯æŒ Debianã€Ubuntu å’Œ CentOSã€‚

## ç‰¹æ€§

- **æ¨¡å—åŒ–æ¶æ„** - åº“æ–‡ä»¶ä¸æ ¸å¿ƒé€»è¾‘åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **åŒæ¨¡å¼æ”¯æŒ** - ç›´è¿æ¨¡å¼ + Cloudflare Tunnel å†…ç½‘ç©¿é€
- **æ™ºèƒ½ç³»ç»Ÿè¯†åˆ«** - è‡ªåŠ¨æ£€æµ‹åŒ…ç®¡ç†å™¨ (`apk`/`apt`/`yum`) å’ŒæœåŠ¡ç®¡ç†å™¨ (systemd/OpenRC)
- **æ™ºèƒ½ IP è¯†åˆ«** - å¤š API è½®è¯¢ï¼Œæ”¯æŒ IPv4/IPv6 å›é€€å’Œæœ¬åœ°è·¯ç”±å…œåº•
- **ç«¯å£å ç”¨æ£€æµ‹** - å®‰è£…å‰è‡ªåŠ¨æ£€æµ‹ç«¯å£æ˜¯å¦è¢«å ç”¨
- **å®‰å…¨éšè”½** - è‡ªåŠ¨ç”Ÿæˆ UUIDï¼ŒåŠ¨æ€ WebSocket è·¯å¾„ï¼ˆ4 ä½éšæœºå­—ç¬¦ï¼‰
- **äº¤äº’å¼é…ç½®** - æ”¯æŒè‡ªå®šä¹‰ç«¯å£ï¼Œå¸¦è¾“å…¥éªŒè¯å’Œé”™è¯¯å›æ»š
- **éäº¤äº’æ¨¡å¼** - æ”¯æŒå‘½ä»¤è¡Œå‚æ•°ï¼Œé€‚åˆè‡ªåŠ¨åŒ–éƒ¨ç½²
- **æœåŠ¡ç®¡ç†** - å†…ç½®æœåŠ¡ç®¡ç†èœå•ï¼Œæ”¯æŒå¯åœã€çŠ¶æ€æŸ¥çœ‹ã€é…ç½®é“¾æ¥æŸ¥çœ‹
- **ç‰ˆæœ¬æ›´æ–°** - ä¸€é”®æ›´æ–° Xray å’Œ cloudflared åˆ°æœ€æ–°ç‰ˆæœ¬
- **äºŒç»´ç æ˜¾ç¤º** - æ”¯æŒç»ˆç«¯å†…æ˜¾ç¤ºé…ç½®äºŒç»´ç ï¼ˆéœ€ qrencodeï¼‰
- **ä¼˜é€‰åŸŸå** - æ”¯æŒè‡ªå®šä¹‰ä¼˜é€‰åŸŸåï¼Œé»˜è®¤ä½¿ç”¨ `cf.tencentapp.cn`

## å¿«é€Ÿå¼€å§‹

### ç½‘é¡µé…ç½®ç”Ÿæˆå™¨

[ğŸš€ åœ¨çº¿é…ç½®ç”Ÿæˆå™¨](https://audsiui.github.io/xray-jb/generator.html) - å¯è§†åŒ–é…ç½®ç”Ÿæˆï¼Œä¸€é”®å¤åˆ¶å®‰è£…å‘½ä»¤

### ä¸€é”®è¿è¡Œï¼ˆäº¤äº’æ¨¡å¼ï¼‰

```bash
bash <(curl -sL https://raw.githubusercontent.com/audsiui/xray-jb/main/main.sh)
```

è¿è¡Œåä¼šæ˜¾ç¤ºäº¤äº’èœå•ï¼š

```
------------------------------------------------
  Xray + Tunnel å·¥ç¨‹åŒ–éƒ¨ç½²è„šæœ¬
------------------------------------------------
  1. å®‰è£… VLESS + WS (ç›´è¿æ¨¡å¼)
  2. å®‰è£… VLESS + WS + CF Tunnel (å†…ç½‘ç©¿é€)
  3. æœåŠ¡ç®¡ç†
  4. æ›´æ–° Xray/cloudflared ç‰ˆæœ¬
  5. å¸è½½å¹¶æ¸…é™¤æ‰€æœ‰å†…å®¹
  0. é€€å‡º
------------------------------------------------
```

### å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆéäº¤äº’ï¼‰

```bash
# ç›´è¿æ¨¡å¼å®‰è£…
bash main.sh --mode direct --port 443

# éš§é“æ¨¡å¼å®‰è£…ï¼ˆä½¿ç”¨é»˜è®¤ä¼˜é€‰åŸŸåï¼‰
bash main.sh --mode tunnel --port 10086 --domain example.com --token xxxx

# éš§é“æ¨¡å¼å®‰è£…ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ä¼˜é€‰åŸŸåï¼‰
bash main.sh --mode tunnel --port 10086 --domain example.com --token xxxx --opt-domain myä¼˜é€‰åŸŸå.com

# å®‰è£…å¹¶æ˜¾ç¤ºäºŒç»´ç 
bash main.sh --mode direct --port 443 --qr

# æœåŠ¡ç®¡ç†
bash main.sh --manage --action status
bash main.sh --manage --action restart

# æ›´æ–°ç‰ˆæœ¬
bash main.sh --update

# å¸è½½
bash main.sh --mode uninstall

# æŸ¥çœ‹å¸®åŠ©
bash main.sh --help
```

## å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜ |
|------|------|
| `-m, --mode <MODE>` | å®‰è£…æ¨¡å¼: `direct`(ç›´è¿), `tunnel`(CFéš§é“), `uninstall`(å¸è½½), `manage`(ç®¡ç†), `update`(æ›´æ–°) |
| `-p, --port <PORT>` | ç«¯å£å· (ç›´è¿é»˜è®¤ 8080, éš§é“é»˜è®¤ 10086) |
| `-d, --domain <DOMAIN>` | åŸŸå (tunnel æ¨¡å¼å¿…éœ€) |
| `-t, --token <TOKEN>` | Cloudflare Tunnel Token (tunnel æ¨¡å¼å¿…éœ€) |
| `--opt-domain <DOMAIN>` | ä¼˜é€‰åŸŸå (tunnel æ¨¡å¼å¯é€‰ï¼Œé»˜è®¤ `cf.tencentapp.cn`) |
| `-M, --manage` | è¿›å…¥æœåŠ¡ç®¡ç†å­èœå• |
| `-a, --action <ACTION>` | æœåŠ¡æ“ä½œ: `start`, `stop`, `restart`, `status` |
| `-u, --update` | æ›´æ–° Xray å’Œ cloudflared åˆ°æœ€æ–°ç‰ˆæœ¬ |
| `--uninstall` | å¸è½½æ‰€æœ‰æœåŠ¡å¹¶æ¸…ç†æ–‡ä»¶ |
| `-q, --quiet` | é™é»˜æ¨¡å¼ï¼Œå‡å°‘è¾“å‡º |
| `--qr` | å®‰è£…å®Œæˆåæ˜¾ç¤ºäºŒç»´ç  (éœ€ qrencode) |
| `-h, --help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

## å®‰è£…æ¨¡å¼

### ç›´è¿æ¨¡å¼

é€‚ç”¨äºæœ‰å…¬ç½‘ IP çš„æœåŠ¡å™¨ï¼š
- Xray ç›‘å¬ `0.0.0.0:ç«¯å£`
- è¾“å‡ºå¸¦å…¬ç½‘ IP çš„ `vless://` é“¾æ¥

```bash
# äº¤äº’å¼å®‰è£…
bash main.sh
# é€‰æ‹© 1

# å‘½ä»¤è¡Œå®‰è£…
bash main.sh --mode direct --port 443
```

### Tunnel æ¨¡å¼

é€‚ç”¨äºæ— å…¬ç½‘ IP æˆ–éœ€éšè—çœŸå® IPï¼š
- Xray ä»…ç›‘å¬ `127.0.0.1:ç«¯å£`ï¼ˆæœ¬åœ°ï¼‰
- é€šè¿‡ Cloudflare Tunnel æš´éœ²
- éœ€æä¾› CF Tunnel Token
- æ”¯æŒè‡ªå®šä¹‰ä¼˜é€‰åŸŸå

```bash
# äº¤äº’å¼å®‰è£…
bash main.sh
# é€‰æ‹© 2

# å‘½ä»¤è¡Œå®‰è£…ï¼ˆä½¿ç”¨é»˜è®¤ä¼˜é€‰åŸŸåï¼‰
bash main.sh --mode tunnel --domain example.com --token xxxx

# å‘½ä»¤è¡Œå®‰è£…ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ä¼˜é€‰åŸŸåï¼‰
bash main.sh --mode tunnel --domain example.com --token xxxx --opt-domain myä¼˜é€‰åŸŸå.com
```

## æœåŠ¡ç®¡ç†

### æœåŠ¡ç®¡ç†èœå•

```
------------------------------------------------
  æœåŠ¡ç®¡ç†
------------------------------------------------
  1. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
  2. å¯åŠ¨æœåŠ¡
  3. åœæ­¢æœåŠ¡
  4. é‡å¯æœåŠ¡
  5. æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
  6. æŸ¥çœ‹é…ç½®é“¾æ¥
  7. æ˜¾ç¤ºé…ç½®äºŒç»´ç 
  0. è¿”å›ä¸»èœå•
------------------------------------------------
```

### æ–‡ä»¶è·¯å¾„

- **å·¥ä½œç›®å½•**: `/opt/xray-bundle/`
- **é…ç½®æ–‡ä»¶**: `/opt/xray-bundle/config.json`
- **ç¨‹åºæ–‡ä»¶**: `/opt/xray-bundle/xray`ã€`/opt/xray-bundle/cloudflared`

### æœåŠ¡å‘½ä»¤

**Systemd (Debian/Ubuntu/CentOS):**

| æœåŠ¡ | è¯´æ˜ |
|------|------|
| `xray-d` | ç›´è¿æ¨¡å¼ Xray æœåŠ¡ |
| `xray-t` | éš§é“æ¨¡å¼ Xray æœåŠ¡ |
| `cloudflared-t` | Cloudflare Tunnel æœåŠ¡ |

```bash
systemctl start/stop/restart/status xray-d
systemctl start/stop/restart/status xray-t
systemctl start/stop/restart/status cloudflared-t
```

**OpenRC (Alpine):**

```bash
rc-service xray-d start/stop/restart/status
rc-service xray-t start/stop/restart/status
rc-service cloudflared-t start/stop/restart/status
```

### å‘½ä»¤è¡ŒæœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹çŠ¶æ€
bash main.sh --manage --action status

# é‡å¯æœåŠ¡
bash main.sh --manage --action restart

# åœæ­¢æœåŠ¡
bash main.sh --manage --action stop

# å¯åŠ¨æœåŠ¡
bash main.sh --manage --action start
```

## ç‰ˆæœ¬æ›´æ–°

### äº¤äº’å¼æ›´æ–°

```bash
bash main.sh
# é€‰æ‹© 4
```

### å‘½ä»¤è¡Œæ›´æ–°

```bash
# æ›´æ–°æ‰€æœ‰ç»„ä»¶
bash main.sh --update
```

æ›´æ–°åŠŸèƒ½ä¼šè‡ªåŠ¨æ£€æµ‹æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶æ”¯æŒï¼š
- æ›´æ–° Xray
- æ›´æ–° cloudflared
- å…¨éƒ¨æ›´æ–°
- è‡ªåŠ¨å¤‡ä»½æ—§ç‰ˆæœ¬
- æ›´æ–°å¤±è´¥è‡ªåŠ¨å›æ»š

## äºŒç»´ç æ˜¾ç¤º

### å®‰è£…æ—¶æ˜¾ç¤ºäºŒç»´ç 

```bash
bash main.sh --mode direct --port 443 --qr
```

### æœåŠ¡ç®¡ç†ä¸­æŸ¥çœ‹äºŒç»´ç 

```bash
bash main.sh
# é€‰æ‹© 3. æœåŠ¡ç®¡ç†
# é€‰æ‹© 7. æ˜¾ç¤ºé…ç½®äºŒç»´ç 
```

**æ³¨æ„**: éœ€è¦å®‰è£… `qrencode` å·¥å…·

```bash
# Alpine
apk add qrencode

# Debian/Ubuntu
apt install qrencode

# CentOS
yum install qrencode
```

## ä¼˜é€‰åŸŸåè¯´æ˜

ä¼˜é€‰åŸŸåæ˜¯ Cloudflare ä¼˜é€‰ IP æœåŠ¡ï¼Œç”¨äºæå‡è¿æ¥é€Ÿåº¦ã€‚

- **é»˜è®¤å€¼**: `cf.tencentapp.cn`
- **ç”¨é€”**: è¿æ¥åœ°å€ä½¿ç”¨ä¼˜é€‰åŸŸåï¼Œè·å¾—æ›´å¥½çš„é€Ÿåº¦
- **è‡ªå®šä¹‰**: å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ä¼˜é€‰åŸŸåæœåŠ¡

é“¾æ¥æ ¼å¼ï¼š
```
vless://UUID@ä¼˜é€‰åŸŸå:443?encryption=none&security=tls&type=ws&host=ç»‘å®šåŸŸå&path=è·¯å¾„&sni=ç»‘å®šåŸŸå
```

## æ¶æ„

```
jb/
â”œâ”€â”€ main.sh              # å…¥å£ - èœå•ç³»ç»Ÿã€å‚æ•°è§£æ
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ utils.sh         # å·¥å…·å‡½æ•°ï¼šæ—¥å¿—ã€éªŒè¯ã€ä¸‹è½½ã€ç«¯å£æ£€æµ‹ã€äºŒç»´ç 
â”‚   â”œâ”€â”€ system.sh        # ç³»ç»Ÿæ£€æµ‹ï¼šOSã€æ¶æ„ã€åŒ…ç®¡ç†å™¨
â”‚   â”œâ”€â”€ service.sh       # æœåŠ¡ç®¡ç†ï¼šsystemd / OpenRC
â”‚   â””â”€â”€ args.sh          # å‘½ä»¤è¡Œå‚æ•°è§£æ
â””â”€â”€ core/
    â”œâ”€â”€ install_direct.sh   # ç›´è¿æ¨¡å¼å®‰è£…
    â”œâ”€â”€ install_tunnel.sh   # éš§é“æ¨¡å¼å®‰è£…
    â”œâ”€â”€ uninstall.sh        # å¸è½½
    â”œâ”€â”€ manage.sh           # æœåŠ¡ç®¡ç†
    â””â”€â”€ update.sh           # ç‰ˆæœ¬æ›´æ–°
```

## æ³¨æ„äº‹é¡¹

1. **é˜²ç«å¢™** - è¯·åœ¨äº‘æœåŠ¡å•†å®‰å…¨ç»„æ”¾è¡Œæ‰€é€‰ç«¯å£ï¼ˆTCPï¼‰
2. **TLS åŠ å¯†** - æœ¬è„šæœ¬ä¸ºæ—  TLS æ¨¡å¼ï¼Œå»ºè®®é…åˆ CDN æˆ–åä»£ä½¿ç”¨
3. **Alpine ç”¨æˆ·** - è„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…å…¼å®¹åŒ… (`gcompat` ç­‰)
4. **ç«¯å£å ç”¨** - è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ç«¯å£å ç”¨ï¼Œæç¤ºç”¨æˆ·å¤„ç†
5. **ä¼˜é€‰åŸŸå** - éš§é“æ¨¡å¼ä½¿ç”¨ä¼˜é€‰åŸŸåå¯ä»¥è·å¾—æ›´å¥½çš„è¿æ¥é€Ÿåº¦

## License

MIT
