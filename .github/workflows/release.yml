name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get version
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Create archive
        run: |
          mkdir -p dist
          tar czf dist/xray-jb-${{ steps.version.outputs.VERSION }}.tar.gz \
            --exclude='.git' \
            --exclude='.github' \
            --exclude='dist' \
            .

      - name: Generate checksum
        run: |
          cd dist
          sha256sum xray-jb-${{ steps.version.outputs.VERSION }}.tar.gz > SHA256SUMS

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/*.tar.gz
            dist/SHA256SUMS
          body: |
            ## Xray VLESS å·¥ç¨‹åŒ–éƒ¨ç½²è„šæœ¬ ${{ steps.version.outputs.VERSION }}

            ### ä¸‹è½½
            - `xray-jb-${{ steps.version.outputs.VERSION }}.tar.gz` - å®Œæ•´æºç åŒ…
            - `SHA256SUMS` - æ ¡éªŒæ–‡ä»¶

            ### å®‰è£…

            ```bash
            # ä¸‹è½½å¹¶è§£å‹
            wget https://github.com/audsiui/xray-jb/releases/download/${{ steps.version.outputs.VERSION }}/xray-jb-${{ steps.version.outputs.VERSION }}.tar.gz
            tar xzf xray-jb-${{ steps.version.outputs.VERSION }}.tar.gz

            # è¿è¡Œè„šæœ¬
            cd jb
            bash main.sh
            ```

            ### ä¸€é”®è¿è¡Œ

            ```bash
            bash <(curl -sL https://raw.githubusercontent.com/audsiui/xray-jb/main/main.sh)
            ```

            ### åœ¨çº¿é…ç½®ç”Ÿæˆå™¨

            ğŸ”§ [é…ç½®ç”Ÿæˆå™¨](https://audsiui.github.io/xray-jb/generator.html)

            ### æ›´æ–°å†…å®¹

            æŸ¥çœ‹æäº¤è®°å½•äº†è§£è¯¦ç»†å˜æ›´ã€‚
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
